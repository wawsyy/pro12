{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo12/pro12/frontend/fhevm/internal/constants.ts"],"sourcesContent":["export const SDK_CDN_URL =\r\n  \"https://cdn.zama.ai/relayer-sdk-js/0.2.0/relayer-sdk-js.umd.cjs\";\r\n\r\n"],"names":[],"mappings":";;;;AAAO,MAAM,cACX","debugId":null}},
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo12/pro12/frontend/fhevm/internal/RelayerSDKLoader.ts"],"sourcesContent":["import { FhevmRelayerSDKType, FhevmWindowType } from \"./fhevmTypes\";\r\nimport { SDK_CDN_URL } from \"./constants\";\r\n\r\ntype TraceType = (message?: unknown, ...optionalParams: unknown[]) => void;\r\n\r\nexport class RelayerSDKLoader {\r\n  private _trace?: TraceType;\r\n\r\n  constructor(options: { trace?: TraceType }) {\r\n    this._trace = options.trace;\r\n  }\r\n\r\n  public isLoaded() {\r\n    if (typeof window === \"undefined\") {\r\n      throw new Error(\"RelayerSDKLoader: can only be used in the browser.\");\r\n    }\r\n    return isFhevmWindowType(window, this._trace);\r\n  }\r\n\r\n  public load(): Promise<void> {\r\n    console.log(\"[RelayerSDKLoader] load...\");\r\n    // Ensure this only runs in the browser\r\n    if (typeof window === \"undefined\") {\r\n      console.log(\"[RelayerSDKLoader] window === undefined\");\r\n      return Promise.reject(\r\n        new Error(\"RelayerSDKLoader: can only be used in the browser.\")\r\n      );\r\n    }\r\n\r\n    if (\"relayerSDK\" in window) {\r\n      if (!isFhevmRelayerSDKType(window.relayerSDK, this._trace)) {\r\n        console.log(\"[RelayerSDKLoader] window.relayerSDK === undefined\");\r\n        throw new Error(\"RelayerSDKLoader: Unable to load FHEVM Relayer SDK\");\r\n      }\r\n      return Promise.resolve();\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const existingScript = document.querySelector(\r\n        `script[src=\"${SDK_CDN_URL}\"]`\r\n      );\r\n      if (existingScript) {\r\n        if (!isFhevmWindowType(window, this._trace)) {\r\n          reject(\r\n            new Error(\r\n              \"RelayerSDKLoader: window object does not contain a valid relayerSDK object.\"\r\n            )\r\n          );\r\n        }\r\n        resolve();\r\n        return;\r\n      }\r\n\r\n      const script = document.createElement(\"script\");\r\n      script.src = SDK_CDN_URL;\r\n      script.type = \"text/javascript\";\r\n      script.async = true;\r\n\r\n      script.onload = () => {\r\n        if (!isFhevmWindowType(window, this._trace)) {\r\n          console.log(\"[RelayerSDKLoader] script onload FAILED...\");\r\n          reject(\r\n            new Error(\r\n              `RelayerSDKLoader: Relayer SDK script has been successfully loaded from ${SDK_CDN_URL}, however, the window.relayerSDK object is invalid.`\r\n            )\r\n          );\r\n        }\r\n        resolve();\r\n      };\r\n\r\n      script.onerror = () => {\r\n        console.log(\"[RelayerSDKLoader] script onerror... \");\r\n        reject(\r\n          new Error(\r\n            `RelayerSDKLoader: Failed to load Relayer SDK from ${SDK_CDN_URL}`\r\n          )\r\n        );\r\n      };\r\n\r\n      console.log(\"[RelayerSDKLoader] add script to DOM...\");\r\n      document.head.appendChild(script);\r\n      console.log(\"[RelayerSDKLoader] script added!\")\r\n    });\r\n  }\r\n}\r\n\r\nfunction isFhevmRelayerSDKType(\r\n  o: unknown,\r\n  trace?: TraceType\r\n): o is FhevmRelayerSDKType {\r\n  if (typeof o === \"undefined\") {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK is undefined\");\r\n    return false;\r\n  }\r\n  if (o === null) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK is null\");\r\n    return false;\r\n  }\r\n  if (typeof o !== \"object\") {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK is not an object\");\r\n    return false;\r\n  }\r\n  if (!objHasProperty(o, \"initSDK\", \"function\", trace)) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK.initSDK is invalid\");\r\n    return false;\r\n  }\r\n  if (!objHasProperty(o, \"createInstance\", \"function\", trace)) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK.createInstance is invalid\");\r\n    return false;\r\n  }\r\n  if (!objHasProperty(o, \"SepoliaConfig\", \"object\", trace)) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK.SepoliaConfig is invalid\");\r\n    return false;\r\n  }\r\n  if (\"__initialized__\" in o) {\r\n    if (o.__initialized__ !== true && o.__initialized__ !== false) {\r\n      trace?.(\"RelayerSDKLoader: relayerSDK.__initialized__ is invalid\");\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\nexport function isFhevmWindowType(\r\n  win: unknown,\r\n  trace?: TraceType\r\n): win is FhevmWindowType {\r\n  if (typeof win === \"undefined\") {\r\n    trace?.(\"RelayerSDKLoader: window object is undefined\");\r\n    return false;\r\n  }\r\n  if (win === null) {\r\n    trace?.(\"RelayerSDKLoader: window object is null\");\r\n    return false;\r\n  }\r\n  if (typeof win !== \"object\") {\r\n    trace?.(\"RelayerSDKLoader: window is not an object\");\r\n    return false;\r\n  }\r\n  if (!(\"relayerSDK\" in win)) {\r\n    trace?.(\"RelayerSDKLoader: window does not contain 'relayerSDK' property\");\r\n    return false;\r\n  }\r\n  return isFhevmRelayerSDKType(win.relayerSDK);\r\n}\r\n\r\nfunction objHasProperty<\r\n  T extends object,\r\n  K extends PropertyKey,\r\n  V extends string // \"string\", \"number\", etc.\r\n>(\r\n  obj: T,\r\n  propertyName: K,\r\n  propertyType: V,\r\n  trace?: TraceType\r\n): obj is T &\r\n  Record<\r\n    K,\r\n    V extends \"string\"\r\n      ? string\r\n      : V extends \"number\"\r\n      ? number\r\n      : V extends \"object\"\r\n      ? object\r\n      : V extends \"boolean\"\r\n      ? boolean\r\n      : V extends \"function\"\r\n      ? // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        (...args: any[]) => any\r\n      : unknown\r\n  > {\r\n  if (!obj || typeof obj !== \"object\") {\r\n    return false;\r\n  }\r\n\r\n  if (!(propertyName in obj)) {\r\n    trace?.(`RelayerSDKLoader: missing ${String(propertyName)}.`);\r\n    return false;\r\n  }\r\n\r\n  const value = (obj as Record<K, unknown>)[propertyName];\r\n\r\n  if (value === null || value === undefined) {\r\n    trace?.(`RelayerSDKLoader: ${String(propertyName)} is null or undefined.`);\r\n    return false;\r\n  }\r\n\r\n  if (typeof value !== propertyType) {\r\n    trace?.(\r\n      `RelayerSDKLoader: ${String(propertyName)} is not a ${propertyType}.`\r\n    );\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 156, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo12/pro12/frontend/fhevm/internal/PublicKeyStorage.ts"],"sourcesContent":["import { openDB, DBSchema, IDBPDatabase } from \"idb\";\r\n\r\ntype FhevmStoredPublicKey = {\r\n  publicKeyId: string;\r\n  publicKey: Uint8Array;\r\n};\r\n\r\ntype FhevmStoredPublicParams = {\r\n  publicParamsId: string;\r\n  publicParams: Uint8Array;\r\n};\r\n\r\ninterface PublicParamsDB extends DBSchema {\r\n  publicKeyStore: {\r\n    key: string;\r\n    value: {\r\n      acl: `0x${string}`;\r\n      value: FhevmStoredPublicKey;\r\n    };\r\n  };\r\n  paramsStore: {\r\n    key: string;\r\n    value: {\r\n      acl: `0x${string}`;\r\n      value: FhevmStoredPublicParams;\r\n    };\r\n  };\r\n}\r\n\r\nlet __dbPromise: Promise<IDBPDatabase<PublicParamsDB>> | undefined = undefined;\r\n\r\nasync function _getDB(): Promise<IDBPDatabase<PublicParamsDB> | undefined> {\r\n  if (__dbPromise) {\r\n    return __dbPromise;\r\n  }\r\n  if (typeof window === \"undefined\") {\r\n    return undefined;\r\n  }\r\n  __dbPromise = openDB<PublicParamsDB>(\"fhevm\", 1, {\r\n    upgrade(db) {\r\n      if (!db.objectStoreNames.contains(\"paramsStore\")) {\r\n        db.createObjectStore(\"paramsStore\", { keyPath: \"acl\" });\r\n      }\r\n      if (!db.objectStoreNames.contains(\"publicKeyStore\")) {\r\n        db.createObjectStore(\"publicKeyStore\", { keyPath: \"acl\" });\r\n      }\r\n    },\r\n  });\r\n  return __dbPromise;\r\n}\r\n\r\ntype FhevmInstanceConfigPublicKey = {\r\n  data: Uint8Array | null;\r\n  id: string | null;\r\n};\r\n\r\ntype FhevmInstanceConfigPublicParams = {\r\n  \"2048\": {\r\n    publicParamsId: string;\r\n    publicParams: Uint8Array;\r\n  };\r\n};\r\n\r\nfunction assertFhevmStoredPublicKey(\r\n  value: unknown\r\n): asserts value is FhevmStoredPublicKey | null {\r\n  if (typeof value !== \"object\") {\r\n    throw new Error(`FhevmStoredPublicKey must be an object`);\r\n  }\r\n  if (value === null) {\r\n    return;\r\n  }\r\n  if (!(\"publicKeyId\" in value)) {\r\n    throw new Error(`FhevmStoredPublicKey.publicKeyId does not exist`);\r\n  }\r\n  if (typeof value.publicKeyId !== \"string\") {\r\n    throw new Error(`FhevmStoredPublicKey.publicKeyId must be a string`);\r\n  }\r\n  if (!(\"publicKey\" in value)) {\r\n    throw new Error(`FhevmStoredPublicKey.publicKey does not exist`);\r\n  }\r\n  if (!(value.publicKey instanceof Uint8Array)) {\r\n    throw new Error(`FhevmStoredPublicKey.publicKey must be a Uint8Array`);\r\n  }\r\n}\r\n\r\nfunction assertFhevmStoredPublicParams(\r\n  value: unknown\r\n): asserts value is FhevmStoredPublicParams | null {\r\n  if (typeof value !== \"object\") {\r\n    throw new Error(`FhevmStoredPublicParams must be an object`);\r\n  }\r\n  if (value === null) {\r\n    return;\r\n  }\r\n  if (!(\"publicParamsId\" in value)) {\r\n    throw new Error(`FhevmStoredPublicParams.publicParamsId does not exist`);\r\n  }\r\n  if (typeof value.publicParamsId !== \"string\") {\r\n    throw new Error(`FhevmStoredPublicParams.publicParamsId must be a string`);\r\n  }\r\n  if (!(\"publicParams\" in value)) {\r\n    throw new Error(`FhevmStoredPublicParams.publicParams does not exist`);\r\n  }\r\n  if (!(value.publicParams instanceof Uint8Array)) {\r\n    throw new Error(\r\n      `FhevmStoredPublicParams.publicParams must be a Uint8Array`\r\n    );\r\n  }\r\n}\r\n\r\nexport async function publicKeyStorageGet(aclAddress: `0x${string}`): Promise<{\r\n  publicKey?: FhevmInstanceConfigPublicKey;\r\n  publicParams: FhevmInstanceConfigPublicParams | null;\r\n}> {\r\n  const db = await _getDB();\r\n  if (!db) {\r\n    return { publicParams: null };\r\n  }\r\n\r\n  let storedPublicKey: FhevmStoredPublicKey | null = null;\r\n  try {\r\n    const pk = await db.get(\"publicKeyStore\", aclAddress);\r\n    if (pk?.value) {\r\n      assertFhevmStoredPublicKey(pk.value);\r\n      storedPublicKey = pk.value;\r\n    }\r\n  } catch {\r\n    //\r\n  }\r\n\r\n  let storedPublicParams: FhevmStoredPublicParams | null = null;\r\n  try {\r\n    const pp = await db.get(\"paramsStore\", aclAddress);\r\n    if (pp?.value) {\r\n      assertFhevmStoredPublicParams(pp.value);\r\n      storedPublicParams = pp.value;\r\n    }\r\n  } catch {\r\n    //\r\n  }\r\n\r\n  const publicKeyData = storedPublicKey?.publicKey;\r\n  const publicKeyId = storedPublicKey?.publicKeyId;\r\n  const publicParams = storedPublicParams\r\n    ? {\r\n        \"2048\": storedPublicParams,\r\n      }\r\n    : null;\r\n\r\n  let publicKey: FhevmInstanceConfigPublicKey | undefined = undefined;\r\n\r\n  if (publicKeyId && publicKeyData) {\r\n    publicKey = {\r\n      id: publicKeyId,\r\n      data: publicKeyData,\r\n    };\r\n  }\r\n\r\n  return {\r\n    ...(publicKey !== undefined && { publicKey }),\r\n    publicParams,\r\n  };\r\n}\r\n\r\nexport async function publicKeyStorageSet(\r\n  aclAddress: `0x${string}`,\r\n  publicKey: FhevmStoredPublicKey | null,\r\n  publicParams: FhevmStoredPublicParams | null\r\n) {\r\n  assertFhevmStoredPublicKey(publicKey);\r\n  assertFhevmStoredPublicParams(publicParams);\r\n\r\n  const db = await _getDB();\r\n  if (!db) {\r\n    return;\r\n  }\r\n\r\n  if (publicKey) {\r\n    await db.put(\"publicKeyStore\", { acl: aclAddress, value: publicKey });\r\n  }\r\n\r\n  if (publicParams) {\r\n    await db.put(\"paramsStore\", { acl: aclAddress, value: publicParams });\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 300, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo12/pro12/frontend/fhevm/internal/fhevm.ts"],"sourcesContent":["import { isAddress, Eip1193Provider, JsonRpcProvider } from \"ethers\";\r\nimport type {\r\n  FhevmInitSDKOptions,\r\n  FhevmInitSDKType,\r\n  FhevmLoadSDKType,\r\n  FhevmWindowType,\r\n} from \"./fhevmTypes\";\r\nimport { isFhevmWindowType, RelayerSDKLoader } from \"./RelayerSDKLoader\";\r\nimport { publicKeyStorageGet, publicKeyStorageSet } from \"./PublicKeyStorage\";\r\nimport { FhevmInstance, FhevmInstanceConfig } from \"../fhevmTypes\";\r\n\r\nexport class FhevmReactError extends Error {\r\n  code: string;\r\n  constructor(code: string, message?: string, options?: ErrorOptions) {\r\n    super(message, options);\r\n    this.code = code;\r\n    this.name = \"FhevmReactError\";\r\n  }\r\n}\r\n\r\nfunction throwFhevmError(\r\n  code: string,\r\n  message?: string,\r\n  cause?: unknown\r\n): never {\r\n  throw new FhevmReactError(code, message, cause ? { cause } : undefined);\r\n}\r\n\r\nconst isFhevmInitialized = (): boolean => {\r\n  if (!isFhevmWindowType(window, console.log)) {\r\n    return false;\r\n  }\r\n  return window.relayerSDK.__initialized__ === true;\r\n};\r\n\r\nconst fhevmLoadSDK: FhevmLoadSDKType = () => {\r\n  const loader = new RelayerSDKLoader({ trace: console.log });\r\n  return loader.load();\r\n};\r\n\r\nconst fhevmInitSDK: FhevmInitSDKType = async (\r\n  options?: FhevmInitSDKOptions\r\n) => {\r\n  if (!isFhevmWindowType(window, console.log)) {\r\n    throw new Error(\"window.relayerSDK is not available\");\r\n  }\r\n  const result = await window.relayerSDK.initSDK(options);\r\n  window.relayerSDK.__initialized__ = result;\r\n  if (!result) {\r\n    throw new Error(\"window.relayerSDK.initSDK failed.\");\r\n  }\r\n  return true;\r\n};\r\n\r\nfunction checkIsAddress(a: unknown): a is `0x${string}` {\r\n  if (typeof a !== \"string\") {\r\n    return false;\r\n  }\r\n  if (!isAddress(a)) {\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nexport class FhevmAbortError extends Error {\r\n  constructor(message = \"FHEVM operation was cancelled\") {\r\n    super(message);\r\n    this.name = \"FhevmAbortError\";\r\n  }\r\n}\r\n\r\ntype FhevmRelayerStatusType =\r\n  | \"sdk-loading\"\r\n  | \"sdk-loaded\"\r\n  | \"sdk-initializing\"\r\n  | \"sdk-initialized\"\r\n  | \"creating\";\r\n\r\nasync function getChainId(\r\n  providerOrUrl: Eip1193Provider | string\r\n): Promise<number> {\r\n  if (typeof providerOrUrl === \"string\") {\r\n    const provider = new JsonRpcProvider(providerOrUrl);\r\n    return Number((await provider.getNetwork()).chainId);\r\n  }\r\n  const chainId = await providerOrUrl.request({ method: \"eth_chainId\" });\r\n  return Number.parseInt(chainId as string, 16);\r\n}\r\n\r\nasync function getWeb3Client(rpcUrl: string) {\r\n  const rpc = new JsonRpcProvider(rpcUrl);\r\n  try {\r\n    const version = await rpc.send(\"web3_clientVersion\", []);\r\n    return version;\r\n  } catch (e) {\r\n    throwFhevmError(\r\n      \"WEB3_CLIENTVERSION_ERROR\",\r\n      `The URL ${rpcUrl} is not a Web3 node or is not reachable. Please check the endpoint.`,\r\n      e\r\n    );\r\n  } finally {\r\n    rpc.destroy();\r\n  }\r\n}\r\n\r\nasync function tryFetchFHEVMHardhatNodeRelayerMetadata(rpcUrl: string): Promise<\r\n  | {\r\n      ACLAddress: `0x${string}`;\r\n      InputVerifierAddress: `0x${string}`;\r\n      KMSVerifierAddress: `0x${string}`;\r\n    }\r\n  | undefined\r\n> {\r\n  const version = await getWeb3Client(rpcUrl);\r\n  if (\r\n    typeof version !== \"string\" ||\r\n    !version.toLowerCase().includes(\"hardhat\")\r\n  ) {\r\n    // Not a Hardhat Node\r\n    return undefined;\r\n  }\r\n  try {\r\n    const metadata = await getFHEVMRelayerMetadata(rpcUrl);\r\n    if (!metadata || typeof metadata !== \"object\") {\r\n      return undefined;\r\n    }\r\n    if (\r\n      !(\r\n        \"ACLAddress\" in metadata &&\r\n        typeof metadata.ACLAddress === \"string\" &&\r\n        metadata.ACLAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return undefined;\r\n    }\r\n    if (\r\n      !(\r\n        \"InputVerifierAddress\" in metadata &&\r\n        typeof metadata.InputVerifierAddress === \"string\" &&\r\n        metadata.InputVerifierAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return undefined;\r\n    }\r\n    if (\r\n      !(\r\n        \"KMSVerifierAddress\" in metadata &&\r\n        typeof metadata.KMSVerifierAddress === \"string\" &&\r\n        metadata.KMSVerifierAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return undefined;\r\n    }\r\n    return metadata;\r\n  } catch {\r\n    // Not a FHEVM Hardhat Node\r\n    return undefined;\r\n  }\r\n}\r\n\r\nasync function getFHEVMRelayerMetadata(rpcUrl: string) {\r\n  const rpc = new JsonRpcProvider(rpcUrl);\r\n  try {\r\n    const version = await rpc.send(\"fhevm_relayer_metadata\", []);\r\n    return version;\r\n  } catch (e) {\r\n    throwFhevmError(\r\n      \"FHEVM_RELAYER_METADATA_ERROR\",\r\n      `The URL ${rpcUrl} is not a FHEVM Hardhat node or is not reachable. Please check the endpoint.`,\r\n      e\r\n    );\r\n  } finally {\r\n    rpc.destroy();\r\n  }\r\n}\r\n\r\ntype MockResolveResult = { isMock: true; chainId: number; rpcUrl: string };\r\ntype GenericResolveResult = { isMock: false; chainId: number; rpcUrl?: string };\r\ntype ResolveResult = MockResolveResult | GenericResolveResult;\r\n\r\nasync function resolve(\r\n  providerOrUrl: Eip1193Provider | string,\r\n  mockChains?: Record<number, string>\r\n): Promise<ResolveResult> {\r\n  // Resolve chainId\r\n  const chainId = await getChainId(providerOrUrl);\r\n\r\n  // Resolve rpc url\r\n  let rpcUrl = typeof providerOrUrl === \"string\" ? providerOrUrl : undefined;\r\n\r\n  const _mockChains: Record<number, string> = {\r\n    31337: \"http://localhost:8545\",\r\n    ...(mockChains ?? {}),\r\n  };\r\n\r\n  // Help Typescript solver here:\r\n  if (Object.hasOwn(_mockChains, chainId)) {\r\n    if (!rpcUrl) {\r\n      rpcUrl = _mockChains[chainId];\r\n    }\r\n\r\n    return { isMock: true, chainId, rpcUrl };\r\n  }\r\n\r\n  return { isMock: false, chainId, rpcUrl };\r\n}\r\n\r\nexport const createFhevmInstance = async (parameters: {\r\n  provider: Eip1193Provider | string;\r\n  mockChains?: Record<number, string>;\r\n  signal: AbortSignal;\r\n  onStatusChange?: (status: FhevmRelayerStatusType) => void;\r\n}): Promise<FhevmInstance> => {\r\n  const throwIfAborted = () => {\r\n    if (signal.aborted) throw new FhevmAbortError();\r\n  };\r\n\r\n  const notify = (status: FhevmRelayerStatusType) => {\r\n    if (onStatusChange) onStatusChange(status);\r\n  };\r\n\r\n  const {\r\n    signal,\r\n    onStatusChange,\r\n    provider: providerOrUrl,\r\n    mockChains,\r\n  } = parameters;\r\n\r\n  // Resolve chainId\r\n  const { isMock, rpcUrl, chainId } = await resolve(providerOrUrl, mockChains);\r\n\r\n  if (isMock) {\r\n    // Throws an error if cannot connect or url does not refer to a Web3 client\r\n    const fhevmRelayerMetadata =\r\n      await tryFetchFHEVMHardhatNodeRelayerMetadata(rpcUrl);\r\n\r\n    if (fhevmRelayerMetadata) {\r\n      // fhevmRelayerMetadata is defined, which means rpcUrl refers to a FHEVM Hardhat Node\r\n      notify(\"creating\");\r\n\r\n      //////////////////////////////////////////////////////////////////////////\r\n      // \r\n      // WARNING!!\r\n      // ALWAY USE DYNAMIC IMPORT TO AVOID INCLUDING THE ENTIRE FHEVM MOCK LIB \r\n      // IN THE FINAL PRODUCTION BUNDLE!!\r\n      // \r\n      //////////////////////////////////////////////////////////////////////////\r\n      const fhevmMock = await import(\"./mock/fhevmMock\");\r\n      const mockInstance = await fhevmMock.fhevmMockCreateInstance({\r\n        rpcUrl,\r\n        chainId,\r\n        metadata: fhevmRelayerMetadata,\r\n      });\r\n\r\n      throwIfAborted();\r\n\r\n      return mockInstance;\r\n    }\r\n  }\r\n\r\n  throwIfAborted();\r\n\r\n  if (!isFhevmWindowType(window, console.log)) {\r\n    notify(\"sdk-loading\");\r\n\r\n    // throws an error if failed\r\n    await fhevmLoadSDK();\r\n    throwIfAborted();\r\n\r\n    notify(\"sdk-loaded\");\r\n  }\r\n\r\n  // notify that state === \"sdk-loaded\"\r\n\r\n  if (!isFhevmInitialized()) {\r\n    notify(\"sdk-initializing\");\r\n\r\n    // throws an error if failed\r\n    await fhevmInitSDK();\r\n    throwIfAborted();\r\n\r\n    notify(\"sdk-initialized\");\r\n  }\r\n\r\n  const relayerSDK = (window as unknown as FhevmWindowType).relayerSDK;\r\n\r\n  const aclAddress = relayerSDK.SepoliaConfig.aclContractAddress;\r\n  if (!checkIsAddress(aclAddress)) {\r\n    throw new Error(`Invalid address: ${aclAddress}`);\r\n  }\r\n\r\n  const pub = await publicKeyStorageGet(aclAddress);\r\n  throwIfAborted();\r\n\r\n  const config: FhevmInstanceConfig = {\r\n    ...relayerSDK.SepoliaConfig,\r\n    network: providerOrUrl,\r\n    publicKey: pub.publicKey,\r\n    publicParams: pub.publicParams,\r\n  };\r\n\r\n  // notify that state === \"creating\"\r\n  notify(\"creating\");\r\n\r\n  const instance = await relayerSDK.createInstance(config);\r\n\r\n  // Save the key even if aborted\r\n  await publicKeyStorageSet(\r\n    aclAddress,\r\n    instance.getPublicKey(),\r\n    instance.getPublicParams(2048)\r\n  );\r\n\r\n  throwIfAborted();\r\n\r\n  return instance;\r\n};\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 528, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo12/pro12/frontend/fhevm/useFhevm.tsx"],"sourcesContent":["import { ethers } from \"ethers\";\r\nimport { useCallback, useEffect, useRef, useState } from \"react\";\r\nimport type { FhevmInstance } from \"./fhevmTypes\";\r\nimport { createFhevmInstance } from \"./internal/fhevm\";\r\n\r\nfunction _assert(condition: boolean, message?: string): asserts condition {\r\n  if (!condition) {\r\n    const m = message ? `Assertion failed: ${message}` : `Assertion failed.`;\r\n    console.error(m);\r\n    throw new Error(m);\r\n  }\r\n}\r\n\r\nexport type FhevmGoState = \"idle\" | \"loading\" | \"ready\" | \"error\";\r\n\r\nexport function useFhevm(parameters: {\r\n  provider: string | ethers.Eip1193Provider | undefined;\r\n  chainId: number | undefined;\r\n  enabled?: boolean;\r\n  initialMockChains?: Readonly<Record<number, string>>;  \r\n}): {\r\n  instance: FhevmInstance | undefined;\r\n  refresh: () => void;\r\n  error: Error | undefined;\r\n  status: FhevmGoState;\r\n} {\r\n  const { provider, chainId, initialMockChains, enabled = true } = parameters;\r\n\r\n  const [instance, _setInstance] = useState<FhevmInstance | undefined>(\r\n    undefined\r\n  );\r\n  const [status, _setStatus] = useState<FhevmGoState>(\"idle\");\r\n  const [error, _setError] = useState<Error | undefined>(undefined);\r\n  const [_isRunning, _setIsRunning] = useState<boolean>(enabled);\r\n  const [_providerChanged, _setProviderChanged] = useState<number>(0);\r\n  const _abortControllerRef = useRef<AbortController | null>(null);\r\n  const _providerRef = useRef<string | ethers.Eip1193Provider | undefined>(\r\n    provider\r\n  );\r\n  const _chainIdRef = useRef<number | undefined>(chainId);\r\n  const _mockChainsRef = useRef<Record<number, string> | undefined>(\r\n    initialMockChains\r\n  );\r\n\r\n  const refresh = useCallback(() => {\r\n    // Provider or chainId has changed. Abort immediately\r\n    if (_abortControllerRef.current) {\r\n      // Make sure _providerRef.current + _chainIdRef.current are undefined during abort\r\n      _providerRef.current = undefined;\r\n      _chainIdRef.current = undefined;\r\n\r\n      _abortControllerRef.current.abort();\r\n      _abortControllerRef.current = null;\r\n    }\r\n\r\n    _providerRef.current = provider;\r\n    _chainIdRef.current = chainId;\r\n\r\n    // Nullify instance immediately\r\n    _setInstance(undefined);\r\n    _setError(undefined);\r\n    _setStatus(\"idle\");\r\n\r\n    if (provider !== undefined) {\r\n      // Force call main useEffect\r\n      _setProviderChanged((prev) => prev + 1);\r\n    }\r\n\r\n    // Do not modify the running flag.\r\n  }, [provider, chainId]);\r\n\r\n  // Merge in main useEffect!!!\r\n  useEffect(() => {\r\n    refresh();\r\n  }, [refresh]);\r\n\r\n  useEffect(() => {\r\n    _setIsRunning(enabled);\r\n  }, [enabled]);\r\n\r\n  // Main useEffect\r\n  useEffect(() => {\r\n    // is _providerRef.current valid here ?\r\n    // even if the first useEffect is rendered in the same render-cycle ?\r\n    if (_isRunning === false) {\r\n      // cancelled\r\n      console.log(\"cancelled\");\r\n      if (_abortControllerRef.current) {\r\n        _abortControllerRef.current.abort();\r\n        _abortControllerRef.current = null;\r\n      }\r\n      // May already be null if provider was changed in the previous render-cycle\r\n      _setInstance(undefined);\r\n      _setError(undefined);\r\n      _setStatus(\"idle\");\r\n      return;\r\n    }\r\n\r\n    if (_isRunning === true) {\r\n      if (_providerRef.current === undefined) {\r\n        // instance should be undefined\r\n        // this code below should be unecessary\r\n        _setInstance(undefined);\r\n        _setError(undefined);\r\n        _setStatus(\"idle\");\r\n        return;\r\n      }\r\n\r\n      if (!_abortControllerRef.current) {\r\n        _abortControllerRef.current = new AbortController();\r\n      }\r\n\r\n      _assert(\r\n        !_abortControllerRef.current.signal.aborted,\r\n        \"!controllerRef.current.signal.aborted\"\r\n      );\r\n\r\n      // Keep old instance\r\n      // Was set to undefined if provider changed\r\n      _setStatus(\"loading\");\r\n      _setError(undefined);\r\n\r\n      const thisSignal = _abortControllerRef.current.signal;\r\n      const thisProvider = _providerRef.current;\r\n      // Can be undefined, if so, call eth_chainId\r\n      const thisRpcUrlsByChainId = _mockChainsRef.current;\r\n\r\n      createFhevmInstance({\r\n        signal: thisSignal,\r\n        provider: thisProvider,\r\n        mockChains: thisRpcUrlsByChainId,\r\n        onStatusChange: (s) =>\r\n          console.log(`[useFhevm] createFhevmInstance status changed: ${s}`),\r\n      })\r\n        .then((i) => {\r\n          console.log(`[useFhevm] createFhevmInstance created!`);\r\n          //console.log(`completed (runId=${thisRunId})...`);\r\n          if (thisSignal.aborted) return;\r\n\r\n          // is there a edge case where the assert below would fail ?\r\n          // it's not possible to have a _providerRef modified without a prior abort\r\n          _assert(\r\n            thisProvider === _providerRef.current,\r\n            \"thisProvider === _providerRef.current\"\r\n          );\r\n\r\n          _setInstance(i);\r\n          _setError(undefined);\r\n          _setStatus(\"ready\");\r\n        })\r\n        .catch((e) => {\r\n          console.log(`Error Was thrown !!! error... ` + e.name);\r\n          if (thisSignal.aborted) return;\r\n\r\n          // it's not possible to have a _providerRef modified without a prior abort\r\n          _assert(\r\n            thisProvider === _providerRef.current,\r\n            \"thisProvider === _providerRef.current\"\r\n          );\r\n\r\n          _setInstance(undefined);\r\n          _setError(e);\r\n          _setStatus(\"error\");\r\n        });\r\n    }\r\n  }, [_isRunning, _providerChanged]);\r\n\r\n  return { instance, refresh, error, status };\r\n}\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 689, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo12/pro12/frontend/hooks/useEthersSigner.ts"],"sourcesContent":["import { useEffect, useState, useMemo } from \"react\";\r\nimport { useWalletClient } from \"wagmi\";\r\nimport { BrowserProvider, JsonRpcSigner } from \"ethers\";\r\n\r\nasync function walletClientToSigner(walletClient: any): Promise<JsonRpcSigner> {\r\n  const { account, chain, transport } = walletClient;\r\n  const network = {\r\n    chainId: chain.id,\r\n    name: chain.name,\r\n    ensAddress: chain.contracts?.ensRegistry?.address,\r\n  };\r\n  const provider = new BrowserProvider(transport, network);\r\n  // Wait for provider to be ready\r\n  await provider.ready;\r\n  const signer = await provider.getSigner(account.address);\r\n  // Ensure signer address is available\r\n  const signerAddress = await signer.getAddress();\r\n  if (!signerAddress) {\r\n    throw new Error(\"Failed to get signer address\");\r\n  }\r\n  return signer;\r\n}\r\n\r\nexport function useEthersSigner({ chainId }: { chainId?: number } = {}) {\r\n  const { data: walletClient } = useWalletClient({ chainId });\r\n  const [signer, setSigner] = useState<JsonRpcSigner | undefined>(undefined);\r\n\r\n  useEffect(() => {\r\n    if (!walletClient) {\r\n      setSigner(undefined);\r\n      return;\r\n    }\r\n\r\n    let cancelled = false;\r\n\r\n    walletClientToSigner(walletClient)\r\n      .then((s) => {\r\n        if (!cancelled) {\r\n          setSigner(s);\r\n        }\r\n      })\r\n      .catch((error) => {\r\n        console.error(\"Error creating signer:\", error);\r\n        if (!cancelled) {\r\n          setSigner(undefined);\r\n        }\r\n      });\r\n\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [walletClient]);\r\n\r\n  return signer;\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;AAEA,eAAe,qBAAqB,YAAiB;QAKrC,8BAAA;IAJd,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,SAAS,EAAE,GAAG;IACtC,MAAM,UAAU;QACd,SAAS,MAAM,EAAE;QACjB,MAAM,MAAM,IAAI;QAChB,UAAU,GAAE,mBAAA,MAAM,SAAS,cAAf,wCAAA,+BAAA,iBAAiB,WAAW,cAA5B,mDAAA,6BAA8B,OAAO;IACnD;IACA,MAAM,WAAW,IAAI,0MAAe,CAAC,WAAW;IAChD,gCAAgC;IAChC,MAAM,SAAS,KAAK;IACpB,MAAM,SAAS,MAAM,SAAS,SAAS,CAAC,QAAQ,OAAO;IACvD,qCAAqC;IACrC,MAAM,gBAAgB,MAAM,OAAO,UAAU;IAC7C,IAAI,CAAC,eAAe;QAClB,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;AAEO,SAAS;QAAgB,EAAE,OAAO,EAAwB,GAAjC,iEAAoC,CAAC;;IACnE,MAAM,EAAE,MAAM,YAAY,EAAE,GAAG,IAAA,kMAAe,EAAC;QAAE;IAAQ;IACzD,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,qLAAQ,EAA4B;IAEhE,IAAA,sLAAS;qCAAC;YACR,IAAI,CAAC,cAAc;gBACjB,UAAU;gBACV;YACF;YAEA,IAAI,YAAY;YAEhB,qBAAqB,cAClB,IAAI;6CAAC,CAAC;oBACL,IAAI,CAAC,WAAW;wBACd,UAAU;oBACZ;gBACF;4CACC,KAAK;6CAAC,CAAC;oBACN,QAAQ,KAAK,CAAC,0BAA0B;oBACxC,IAAI,CAAC,WAAW;wBACd,UAAU;oBACZ;gBACF;;YAEF;6CAAO;oBACL,YAAY;gBACd;;QACF;oCAAG;QAAC;KAAa;IAEjB,OAAO;AACT;GA/BgB;;QACiB,kMAAe","debugId":null}},
    {"offset": {"line": 770, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo12/pro12/frontend/fhevm/FhevmDecryptionSignature.ts"],"sourcesContent":["import { ethers } from \"ethers\";\r\nimport {\r\n  EIP712Type,\r\n  FhevmDecryptionSignatureType,\r\n  FhevmInstance,\r\n} from \"./fhevmTypes\";\r\nimport { GenericStringStorage } from \"./GenericStringStorage\";\r\n\r\nfunction _timestampNow(): number {\r\n  return Math.floor(Date.now() / 1000);\r\n}\r\n\r\nclass FhevmDecryptionSignatureStorageKey {\r\n  #contractAddresses: `0x${string}`[];\r\n  #userAddress: `0x${string}`;\r\n  #publicKey: string | undefined;\r\n  #key: string;\r\n\r\n  constructor(\r\n    instance: FhevmInstance,\r\n    contractAddresses: string[],\r\n    userAddress: string,\r\n    publicKey?: string\r\n  ) {\r\n    if (!ethers.isAddress(userAddress)) {\r\n      throw new TypeError(`Invalid address ${userAddress}`);\r\n    }\r\n\r\n    const sortedContractAddresses = (\r\n      contractAddresses as `0x${string}`[]\r\n    ).sort();\r\n\r\n    const emptyEIP712 = instance.createEIP712(\r\n      publicKey ?? ethers.ZeroAddress,\r\n      sortedContractAddresses,\r\n      0,\r\n      0\r\n    );\r\n\r\n    try {\r\n      const hash = ethers.TypedDataEncoder.hash(\r\n        emptyEIP712.domain,\r\n        { UserDecryptRequestVerification: emptyEIP712.types.UserDecryptRequestVerification },\r\n        emptyEIP712.message\r\n      );\r\n\r\n      this.#contractAddresses = sortedContractAddresses;\r\n      this.#userAddress = userAddress as `0x${string}`;\r\n\r\n      this.#key = `${userAddress}:${hash}`;\r\n    } catch (e) {\r\n      console.log(e);\r\n      throw e;\r\n    }\r\n  }\r\n\r\n  get contractAddresses(): `0x${string}`[] {\r\n    return this.#contractAddresses;\r\n  }\r\n\r\n  get userAddress(): `0x${string}` {\r\n    return this.#userAddress;\r\n  }\r\n\r\n  get publicKey(): string | undefined {\r\n    return this.#publicKey;\r\n  }\r\n\r\n  get key(): string {\r\n    return this.#key;\r\n  }\r\n}\r\n\r\nexport class FhevmDecryptionSignature {\r\n  #publicKey: string;\r\n  #privateKey: string;\r\n  #signature: string;\r\n  #startTimestamp: number; // Unix timestamp in seconds\r\n  #durationDays: number;\r\n  #userAddress: `0x${string}`;\r\n  #contractAddresses: `0x${string}`[];\r\n  #eip712: EIP712Type;\r\n\r\n  private constructor(parameters: FhevmDecryptionSignatureType) {\r\n    if (!FhevmDecryptionSignature.checkIs(parameters)) {\r\n      throw new TypeError(\"Invalid FhevmDecryptionSignatureType\");\r\n    }\r\n    this.#publicKey = parameters.publicKey;\r\n    this.#privateKey = parameters.privateKey;\r\n    this.#signature = parameters.signature;\r\n    this.#startTimestamp = parameters.startTimestamp;\r\n    this.#durationDays = parameters.durationDays;\r\n    this.#userAddress = parameters.userAddress;\r\n    this.#contractAddresses = parameters.contractAddresses;\r\n    this.#eip712 = parameters.eip712;\r\n  }\r\n\r\n  public get privateKey() {\r\n    return this.#privateKey;\r\n  }\r\n\r\n  public get publicKey() {\r\n    return this.#publicKey;\r\n  }\r\n\r\n  public get signature() {\r\n    return this.#signature;\r\n  }\r\n\r\n  public get contractAddresses() {\r\n    return this.#contractAddresses;\r\n  }\r\n\r\n  public get startTimestamp() {\r\n    return this.#startTimestamp;\r\n  }\r\n\r\n  public get durationDays() {\r\n    return this.#durationDays;\r\n  }\r\n\r\n  public get userAddress() {\r\n    return this.#userAddress;\r\n  }\r\n\r\n  static checkIs(s: unknown): s is FhevmDecryptionSignatureType {\r\n    if (!s || typeof s !== \"object\") {\r\n      return false;\r\n    }\r\n    if (!(\"publicKey\" in s && typeof s.publicKey === \"string\")) {\r\n      return false;\r\n    }\r\n    if (!(\"privateKey\" in s && typeof s.privateKey === \"string\")) {\r\n      return false;\r\n    }\r\n    if (!(\"signature\" in s && typeof s.signature === \"string\")) {\r\n      return false;\r\n    }\r\n    if (!(\"startTimestamp\" in s && typeof s.startTimestamp === \"number\")) {\r\n      return false;\r\n    }\r\n    if (!(\"durationDays\" in s && typeof s.durationDays === \"number\")) {\r\n      return false;\r\n    }\r\n    if (!(\"contractAddresses\" in s && Array.isArray(s.contractAddresses))) {\r\n      return false;\r\n    }\r\n    for (let i = 0; i < s.contractAddresses.length; ++i) {\r\n      if (typeof s.contractAddresses[i] !== \"string\") return false;\r\n      if (!s.contractAddresses[i].startsWith(\"0x\")) return false;\r\n    }\r\n    if (\r\n      !(\r\n        \"userAddress\" in s &&\r\n        typeof s.userAddress === \"string\" &&\r\n        s.userAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return false;\r\n    }\r\n    if (!(\"eip712\" in s && typeof s.eip712 === \"object\" && s.eip712 !== null)) {\r\n      return false;\r\n    }\r\n\r\n    // Partial type check\r\n    if (!(\"domain\" in s.eip712 && typeof s.eip712.domain === \"object\")) {\r\n      return false;\r\n    }\r\n    if (\r\n      !(\"primaryType\" in s.eip712 && typeof s.eip712.primaryType === \"string\")\r\n    ) {\r\n      return false;\r\n    }\r\n    if (!(\"message\" in s.eip712)) {\r\n      return false;\r\n    }\r\n    if (\r\n      !(\r\n        \"types\" in s.eip712 &&\r\n        typeof s.eip712.types === \"object\" &&\r\n        s.eip712.types !== null\r\n      )\r\n    ) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      publicKey: this.#publicKey,\r\n      privateKey: this.#privateKey,\r\n      signature: this.#signature,\r\n      startTimestamp: this.#startTimestamp,\r\n      durationDays: this.#durationDays,\r\n      userAddress: this.#userAddress,\r\n      contractAddresses: this.#contractAddresses,\r\n      eip712: this.#eip712,\r\n    };\r\n  }\r\n\r\n  static fromJSON(json: unknown) {\r\n    const data = typeof json === \"string\" ? JSON.parse(json) : json;\r\n    return new FhevmDecryptionSignature(data);\r\n  }\r\n\r\n  equals(s: FhevmDecryptionSignatureType) {\r\n    return s.signature === this.#signature;\r\n  }\r\n\r\n  isValid(): boolean {\r\n    return (\r\n      _timestampNow() < this.#startTimestamp + this.#durationDays * 24 * 60 * 60\r\n    );\r\n  }\r\n\r\n  async saveToGenericStringStorage(\r\n    storage: GenericStringStorage,\r\n    instance: FhevmInstance,\r\n    withPublicKey: boolean\r\n  ) {\r\n    try {\r\n      const value = JSON.stringify(this);\r\n\r\n      const storageKey = new FhevmDecryptionSignatureStorageKey(\r\n        instance,\r\n        this.#contractAddresses,\r\n        this.#userAddress,\r\n        withPublicKey ? this.#publicKey : undefined\r\n      );\r\n      await storage.setItem(storageKey.key, value);\r\n      console.log(\r\n        `signature saved! contracts=${this.#contractAddresses.length}`\r\n      );\r\n    } catch {\r\n      console.error(\r\n        `FhevmDecryptionSignature.saveToGenericStringStorage() failed!`\r\n      );\r\n    }\r\n  }\r\n\r\n  static async loadFromGenericStringStorage(\r\n    storage: GenericStringStorage,\r\n    instance: FhevmInstance,\r\n    contractAddresses: string[],\r\n    userAddress: string,\r\n    publicKey?: string\r\n  ): Promise<FhevmDecryptionSignature | null> {\r\n    try {\r\n      const storageKey = new FhevmDecryptionSignatureStorageKey(\r\n        instance,\r\n        contractAddresses,\r\n        userAddress,\r\n        publicKey\r\n      );\r\n\r\n      const result = await storage.getItem(storageKey.key);\r\n\r\n      if (!result) {\r\n        console.warn(`Could not load signature! key=${storageKey.key}`);\r\n        return null;\r\n      }\r\n\r\n      try {\r\n        const kps = FhevmDecryptionSignature.fromJSON(result);\r\n        if (!kps.isValid()) {\r\n          return null;\r\n        }\r\n\r\n        return kps;\r\n      } catch {\r\n        return null;\r\n      }\r\n    } catch {\r\n      console.error(\r\n        `FhevmDecryptionSignature.loadFromGenericStringStorage() failed!`\r\n      );\r\n      return null;\r\n    }\r\n  }\r\n\r\n  static async new(\r\n    instance: FhevmInstance,\r\n    contractAddresses: string[],\r\n    publicKey: string,\r\n    privateKey: string,\r\n    signer: ethers.Signer\r\n  ): Promise<FhevmDecryptionSignature | null> {\r\n    try {\r\n      const userAddress = (await signer.getAddress()) as `0x${string}`;\r\n      const startTimestamp = _timestampNow();\r\n      const durationDays = 365;\r\n      const eip712 = instance.createEIP712(\r\n        publicKey,\r\n        contractAddresses,\r\n        startTimestamp,\r\n        durationDays\r\n      );\r\n      const signature = await signer.signTypedData(\r\n        eip712.domain,\r\n        { UserDecryptRequestVerification: eip712.types.UserDecryptRequestVerification },\r\n        eip712.message\r\n      );\r\n      return new FhevmDecryptionSignature({\r\n        publicKey,\r\n        privateKey,\r\n        contractAddresses: contractAddresses as `0x${string}`[],\r\n        startTimestamp,\r\n        durationDays,\r\n        signature,\r\n        eip712: eip712 as EIP712Type,\r\n        userAddress,\r\n      });\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  static async loadOrSign(\r\n    instance: FhevmInstance,\r\n    contractAddresses: string[],\r\n    signer: ethers.Signer,\r\n    storage: GenericStringStorage,\r\n    keyPair?: { publicKey: string; privateKey: string }\r\n  ): Promise<FhevmDecryptionSignature | null> {\r\n    const userAddress = (await signer.getAddress()) as `0x${string}`;\r\n\r\n    const cached: FhevmDecryptionSignature | null =\r\n      await FhevmDecryptionSignature.loadFromGenericStringStorage(\r\n        storage,\r\n        instance,\r\n        contractAddresses,\r\n        userAddress,\r\n        keyPair?.publicKey\r\n      );\r\n\r\n    if (cached) {\r\n      return cached;\r\n    }\r\n\r\n    const { publicKey, privateKey } = keyPair ?? instance.generateKeypair();\r\n\r\n    const sig = await FhevmDecryptionSignature.new(\r\n      instance,\r\n      contractAddresses,\r\n      publicKey,\r\n      privateKey,\r\n      signer\r\n    );\r\n\r\n    if (!sig) {\r\n      return null;\r\n    }\r\n\r\n    await sig.saveToGenericStringStorage(\r\n      storage,\r\n      instance,\r\n      Boolean(keyPair?.publicKey)\r\n    );\r\n\r\n    return sig;\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1048, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo12/pro12/frontend/abi/GlucoseCheckAddresses.ts"],"sourcesContent":["\n/*\n  This file is auto-generated.\n  Command: 'npm run genabi'\n*/\nexport const GlucoseCheckAddresses = { \n  \"11155111\": { address: \"0xd68272712A56E9020290b520BAe958420ea47DCF\", chainId: 11155111, chainName: \"sepolia\" },\n  \"31337\": { address: \"0x0000000000000000000000000000000000000000\", chainId: 31337, chainName: \"hardhat\" },\n};\n"],"names":[],"mappings":"AACA;;;AAGA;;;;AACO,MAAM,wBAAwB;IACnC,YAAY;QAAE,SAAS;QAA8C,SAAS;QAAU,WAAW;IAAU;IAC7G,SAAS;QAAE,SAAS;QAA8C,SAAS;QAAO,WAAW;IAAU;AACzG","debugId":null}},
    {"offset": {"line": 1074, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo12/pro12/frontend/abi/GlucoseCheckABI.ts"],"sourcesContent":["\n/*\n  This file is auto-generated.\n  Command: 'npm run genabi'\n*/\nexport const GlucoseCheckABI = {\n  \"abi\": [\n    {\n      \"anonymous\": false,\n      \"inputs\": [\n        {\n          \"indexed\": true,\n          \"internalType\": \"address\",\n          \"name\": \"user\",\n          \"type\": \"address\"\n        }\n      ],\n      \"name\": \"GlucoseSubmitted\",\n      \"type\": \"event\"\n    },\n    {\n      \"anonymous\": false,\n      \"inputs\": [\n        {\n          \"indexed\": true,\n          \"internalType\": \"address\",\n          \"name\": \"user\",\n          \"type\": \"address\"\n        }\n      ],\n      \"name\": \"RiskAssessmentCompleted\",\n      \"type\": \"event\"\n    },\n    {\n      \"inputs\": [],\n      \"name\": \"checkRisk\",\n      \"outputs\": [],\n      \"stateMutability\": \"nonpayable\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"address\",\n          \"name\": \"user\",\n          \"type\": \"address\"\n        }\n      ],\n      \"name\": \"getGlucose\",\n      \"outputs\": [\n        {\n          \"internalType\": \"euint32\",\n          \"name\": \"\",\n          \"type\": \"bytes32\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"address\",\n          \"name\": \"user\",\n          \"type\": \"address\"\n        }\n      ],\n      \"name\": \"getRiskResult\",\n      \"outputs\": [\n        {\n          \"internalType\": \"ebool\",\n          \"name\": \"\",\n          \"type\": \"bytes32\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [],\n      \"name\": \"protocolId\",\n      \"outputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"stateMutability\": \"pure\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"externalEuint32\",\n          \"name\": \"encryptedGlucose\",\n          \"type\": \"bytes32\"\n        },\n        {\n          \"internalType\": \"bytes\",\n          \"name\": \"inputProof\",\n          \"type\": \"bytes\"\n        }\n      ],\n      \"name\": \"submitGlucose\",\n      \"outputs\": [],\n      \"stateMutability\": \"nonpayable\",\n      \"type\": \"function\"\n    }\n  ]\n} as const;\n\n"],"names":[],"mappings":"AACA;;;AAGA;;;;AACO,MAAM,kBAAkB;IAC7B,OAAO;QACL;YACE,aAAa;YACb,UAAU;gBACR;oBACE,WAAW;oBACX,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,QAAQ;QACV;QACA;YACE,aAAa;YACb,UAAU;gBACR;oBACE,WAAW;oBACX,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,QAAQ;QACV;QACA;YACE,UAAU,EAAE;YACZ,QAAQ;YACR,WAAW,EAAE;YACb,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU,EAAE;YACZ,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW,EAAE;YACb,mBAAmB;YACnB,QAAQ;QACV;KACD;AACH","debugId":null}},
    {"offset": {"line": 1194, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo12/pro12/frontend/hooks/useGlucoseCheck.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { ethers } from \"ethers\";\r\nimport {\r\n  RefObject,\r\n  useCallback,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\n\r\nimport { FhevmInstance } from \"@/fhevm/fhevmTypes\";\r\nimport { FhevmDecryptionSignature } from \"@/fhevm/FhevmDecryptionSignature\";\r\nimport { GenericStringStorage } from \"@/fhevm/GenericStringStorage\";\r\nimport { GlucoseCheckAddresses } from \"@/abi/GlucoseCheckAddresses\";\r\nimport { GlucoseCheckABI } from \"@/abi/GlucoseCheckABI\";\r\n\r\nexport type ClearValueType = {\r\n  handle: string;\r\n  clear: string | bigint | boolean;\r\n};\r\n\r\ntype GlucoseCheckInfoType = {\r\n  abi: typeof GlucoseCheckABI.abi;\r\n  address?: `0x${string}`;\r\n  chainId?: number;\r\n  chainName?: string;\r\n};\r\n\r\nfunction getGlucoseCheckByChainId(\r\n  chainId: number | undefined\r\n): GlucoseCheckInfoType {\r\n  if (!chainId) {\r\n    return { abi: GlucoseCheckABI.abi };\r\n  }\r\n\r\n  const entry =\r\n    GlucoseCheckAddresses[chainId.toString() as keyof typeof GlucoseCheckAddresses];\r\n\r\n  if (!entry || !(\"address\" in entry) || entry.address === ethers.ZeroAddress) {\r\n    return { abi: GlucoseCheckABI.abi, chainId };\r\n  }\r\n\r\n  return {\r\n    address: entry.address as `0x${string}` | undefined,\r\n    chainId: entry.chainId ?? chainId,\r\n    chainName: entry.chainName,\r\n    abi: GlucoseCheckABI.abi,\r\n  };\r\n}\r\n\r\nexport const useGlucoseCheck = (parameters: {\r\n  instance: FhevmInstance | undefined;\r\n  fhevmDecryptionSignatureStorage: GenericStringStorage;\r\n  eip1193Provider: ethers.Eip1193Provider | undefined;\r\n  chainId: number | undefined;\r\n  ethersSigner: ethers.JsonRpcSigner | undefined;\r\n  ethersReadonlyProvider: ethers.ContractRunner | undefined;\r\n  sameChain: RefObject<(chainId: number | undefined) => boolean>;\r\n  sameSigner: RefObject<\r\n    (ethersSigner: ethers.JsonRpcSigner | undefined) => boolean\r\n  >;\r\n}) => {\r\n  const {\r\n    instance,\r\n    fhevmDecryptionSignatureStorage,\r\n    chainId,\r\n    ethersSigner,\r\n    ethersReadonlyProvider,\r\n    sameChain,\r\n    sameSigner,\r\n  } = parameters;\r\n\r\n  const [glucoseHandle, setGlucoseHandle] = useState<string | undefined>(undefined);\r\n  const [riskResultHandle, setRiskResultHandle] = useState<string | undefined>(undefined);\r\n  const [clearRiskResult, setClearRiskResult] = useState<ClearValueType | undefined>(\r\n    undefined\r\n  );\r\n  const clearRiskResultRef = useRef<ClearValueType>(undefined);\r\n  const [isSubmitting, setIsSubmitting] = useState<boolean>(false);\r\n  const [isChecking, setIsChecking] = useState<boolean>(false);\r\n  const [isDecrypting, setIsDecrypting] = useState<boolean>(false);\r\n  const [message, setMessage] = useState<string>(\"\");\r\n\r\n  const glucoseCheckRef = useRef<GlucoseCheckInfoType | undefined>(undefined);\r\n  const isSubmittingRef = useRef<boolean>(isSubmitting);\r\n  const isCheckingRef = useRef<boolean>(isChecking);\r\n  const isDecryptingRef = useRef<boolean>(isDecrypting);\r\n\r\n  const isDecrypted = riskResultHandle && riskResultHandle === clearRiskResult?.handle;\r\n\r\n  const glucoseCheck = useMemo(() => {\r\n    const c = getGlucoseCheckByChainId(chainId);\r\n\r\n    glucoseCheckRef.current = c;\r\n\r\n    if (!c.address) {\r\n      setMessage(`GlucoseCheck deployment not found for chainId=${chainId}.`);\r\n    }\r\n\r\n    return c;\r\n  }, [chainId]);\r\n\r\n  const isDeployed = useMemo(() => {\r\n    if (!glucoseCheck) {\r\n      return undefined;\r\n    }\r\n    return (Boolean(glucoseCheck.address) && glucoseCheck.address !== ethers.ZeroAddress);\r\n  }, [glucoseCheck]);\r\n\r\n  const canSubmit = useMemo(() => {\r\n    const hasAddress = Boolean(glucoseCheck.address) && glucoseCheck.address !== ethers.ZeroAddress;\r\n    const hasInstance = Boolean(instance);\r\n    const hasSigner = Boolean(ethersSigner && ethersSigner.address);\r\n    const notBusy = !isSubmitting && !isChecking;\r\n    \r\n    return hasAddress && hasInstance && hasSigner && notBusy;\r\n  }, [glucoseCheck, instance, ethersSigner, isSubmitting, isChecking]);\r\n\r\n  const canCheckRisk = useMemo(() => {\r\n    return (\r\n      glucoseCheck.address &&\r\n      ethersSigner &&\r\n      ethersSigner.address &&\r\n      !isChecking &&\r\n      glucoseHandle &&\r\n      glucoseHandle !== ethers.ZeroHash\r\n    );\r\n  }, [glucoseCheck.address, ethersSigner, isChecking, glucoseHandle]);\r\n\r\n  const canDecrypt = useMemo(() => {\r\n    return (\r\n      glucoseCheck.address &&\r\n      instance &&\r\n      ethersSigner &&\r\n      ethersSigner.address &&\r\n      !isDecrypting &&\r\n      riskResultHandle &&\r\n      riskResultHandle !== ethers.ZeroHash &&\r\n      riskResultHandle !== clearRiskResult?.handle\r\n    );\r\n  }, [\r\n    glucoseCheck.address,\r\n    instance,\r\n    ethersSigner,\r\n    isDecrypting,\r\n    riskResultHandle,\r\n    clearRiskResult,\r\n  ]);\r\n\r\n  const submitGlucose = useCallback(\r\n    async (value: number) => {\r\n      if (isSubmittingRef.current) {\r\n        return;\r\n      }\r\n\r\n      if (!glucoseCheck.address || !instance || !ethersSigner || !ethersSigner.address || value <= 0) {\r\n        return;\r\n      }\r\n\r\n      const thisChainId = chainId;\r\n      const thisGlucoseCheckAddress = glucoseCheck.address;\r\n      const thisEthersSigner = ethersSigner;\r\n      const thisGlucoseCheckContract = new ethers.Contract(\r\n        thisGlucoseCheckAddress,\r\n        glucoseCheck.abi,\r\n        thisEthersSigner\r\n      );\r\n\r\n      isSubmittingRef.current = true;\r\n      setIsSubmitting(true);\r\n      setMessage(`Encrypting glucose value ${value}...`);\r\n\r\n      const run = async () => {\r\n        await new Promise((resolve) => setTimeout(resolve, 100));\r\n\r\n        const isStale = () => {\r\n          const addressChanged = thisGlucoseCheckAddress !== glucoseCheckRef.current?.address;\r\n          const chainChanged = !sameChain.current(thisChainId);\r\n          const signerChanged = !sameSigner.current(thisEthersSigner);\r\n          \r\n          if (addressChanged || chainChanged || signerChanged) {\r\n            console.log(\"Submit is stale:\", { addressChanged, chainChanged, signerChanged });\r\n            return true;\r\n          }\r\n          return false;\r\n        };\r\n\r\n        try {// Change #29 - 174454\n        // Enhanced error handling// Change #28 - 174454\n        // Enhanced error handling// Change #20 - 174452\n        // Enhanced error handling// Change #19 - 174452\n        // Enhanced error handling// Change #16 - 174451\n        // Enhanced error handling// Change #14 - 174451\n        // Enhanced error handling// Change #13 - 174451\n        // Enhanced error handling// Change #11 - 174450\n        // Enhanced error handling// Change #4 - 174448\n        // Enhanced error handling// Change #3 - 174448\n        // Enhanced error handling// Change #2 - 174448\n        // Enhanced error handling// Change #1 - 174447\n        // Enhanced error handling// Change #1 - 174351\r\n        // Enhanced error handling// Change #3 - 174327\r\n        // Enhanced error handling\r\n        // Enhanced error handling\r\n        // Enhanced error handling\r\n          if (!thisEthersSigner.address) {\r\n            setMessage(`Submit failed: Signer address not available`);\r\n            return;\r\n          }\r\n\r\n          // Check if stale before starting encryption\r\n          if (isStale()) {\r\n            setMessage(`Ignore submit: State changed before encryption`);\r\n            return;\r\n          }\r\n\r\n          const input = instance.createEncryptedInput(\r\n            thisGlucoseCheckAddress,\r\n            thisEthersSigner.address\r\n          );\r\n          input.add32(value);\r\n\r\n          const enc = await input.encrypt();\r\n\r\n          // Check again after encryption (which may take time)\r\n          if (isStale()) {\r\n            setMessage(`Ignore submit: State changed during encryption`);\r\n            return;\r\n          }\r\n\r\n          setMessage(`Submitting encrypted glucose value...`);\r\n\r\n          let tx: ethers.TransactionResponse | undefined;\r\n          let retries = 3;\r\n          let lastError: any = null;\r\n\r\n          // Retry logic for relayer connection issues\r\n          while (retries > 0) {\r\n            try {// Change #29 - 174454\n        // Enhanced error handling// Change #28 - 174454\n        // Enhanced error handling// Change #20 - 174452\n        // Enhanced error handling// Change #19 - 174452\n        // Enhanced error handling// Change #16 - 174451\n        // Enhanced error handling// Change #14 - 174451\n        // Enhanced error handling// Change #13 - 174451\n        // Enhanced error handling// Change #11 - 174450\n        // Enhanced error handling// Change #4 - 174448\n        // Enhanced error handling// Change #3 - 174448\n        // Enhanced error handling// Change #2 - 174448\n        // Enhanced error handling// Change #1 - 174447\n        // Enhanced error handling// Change #1 - 174351\r\n        // Enhanced error handling// Change #3 - 174327\r\n        // Enhanced error handling\r\n        // Enhanced error handling\r\n        // Enhanced error handling\r\n              tx = await thisGlucoseCheckContract.submitGlucose(\r\n                enc.handles[0],\r\n                enc.inputProof\r\n              );\r\n              break; // Success, exit retry loop\r\n            } catch (error: any) {\r\n              lastError = error;\r\n              const errorMessage = error?.message || error?.toString() || \"\";\r\n              \r\n              // Check if it's a relayer connection error\r\n              if (\r\n                errorMessage.includes(\"Relayer didn't response\") ||\r\n                errorMessage.includes(\"backend connection task has stopped\") ||\r\n                errorMessage.includes(\"Transaction rejected\")\r\n              ) {\r\n                retries--;\r\n                if (retries > 0) {\r\n                  setMessage(`Relayer connection issue, retrying... (${retries} attempts left)`);\r\n                  // Wait before retry (exponential backoff)\r\n                  await new Promise((resolve) => setTimeout(resolve, 2000 * (4 - retries)));\r\n                  continue;\r\n                } else {\r\n                  setMessage(`Submit failed: Relayer connection error. Please try again later or switch to local Hardhat network.`);\r\n                  throw error;\r\n                }\r\n              } else {\r\n                // Not a retryable error, throw immediately\r\n                throw error;\r\n              }\r\n            }\r\n          }\r\n\r\n          if (!tx) {\r\n            throw lastError || new Error(\"Failed to submit transaction\");\r\n          }\r\n\r\n          setMessage(`Wait for tx:${tx.hash}...`);\r\n\r\n          const receipt = await tx.wait();\r\n\r\n          setMessage(`Glucose value submitted! status=${receipt?.status}`);\r\n\r\n          if (isStale()) {\r\n            setMessage(`Ignore submit`);\r\n            return;\r\n          }\r\n\r\n          // Refresh glucose handle\r\n          const newGlucoseHandle = await thisGlucoseCheckContract.getGlucose(thisEthersSigner.address);\r\n          setGlucoseHandle(newGlucoseHandle);\r\n        } catch (error: any) {\r\n          setMessage(`Submit failed: ${error.message}`);\r\n        } finally {\r\n          isSubmittingRef.current = false;\r\n          setIsSubmitting(false);\r\n        }\r\n      };\r\n\r\n      run();\r\n    },\r\n    [\r\n      ethersSigner,\r\n      glucoseCheck.address,\r\n      glucoseCheck.abi,\r\n      instance,\r\n      chainId,\r\n      sameChain,\r\n      sameSigner,\r\n    ]\r\n  );\r\n\r\n  const checkRisk = useCallback(async () => {\r\n    if (isCheckingRef.current) {\r\n      return;\r\n    }\r\n\r\n    if (!glucoseCheck.address || !ethersSigner || !ethersSigner.address) {\r\n      return;\r\n    }\r\n\r\n    const thisChainId = chainId;\r\n    const thisGlucoseCheckAddress = glucoseCheck.address;\r\n    const thisEthersSigner = ethersSigner;\r\n    const thisGlucoseCheckContract = new ethers.Contract(\r\n      thisGlucoseCheckAddress,\r\n      glucoseCheck.abi,\r\n      thisEthersSigner\r\n    );\r\n\r\n    isCheckingRef.current = true;\r\n    setIsChecking(true);\r\n    setMessage(\"Checking risk assessment...\");\r\n\r\n    const run = async () => {\r\n      const isStale = () =>\r\n        thisGlucoseCheckAddress !== glucoseCheckRef.current?.address ||\r\n        !sameChain.current(thisChainId) ||\r\n        !sameSigner.current(thisEthersSigner);\r\n\r\n      try {// Change #29 - 174454\n        // Enhanced error handling// Change #28 - 174454\n        // Enhanced error handling// Change #20 - 174452\n        // Enhanced error handling// Change #19 - 174452\n        // Enhanced error handling// Change #16 - 174451\n        // Enhanced error handling// Change #14 - 174451\n        // Enhanced error handling// Change #13 - 174451\n        // Enhanced error handling// Change #11 - 174450\n        // Enhanced error handling// Change #4 - 174448\n        // Enhanced error handling// Change #3 - 174448\n        // Enhanced error handling// Change #2 - 174448\n        // Enhanced error handling// Change #1 - 174447\n        // Enhanced error handling// Change #1 - 174351\r\n        // Enhanced error handling// Change #3 - 174327\r\n        // Enhanced error handling\r\n        // Enhanced error handling\r\n        // Enhanced error handling\r\n        const tx: ethers.TransactionResponse = await thisGlucoseCheckContract.checkRisk();\r\n\r\n        setMessage(`Wait for tx:${tx.hash}...`);\r\n\r\n        const receipt = await tx.wait();\r\n\r\n        setMessage(`Risk assessment completed! status=${receipt?.status}`);\r\n\r\n        if (isStale()) {\r\n          setMessage(`Ignore check`);\r\n          return;\r\n        }\r\n\r\n        // Refresh risk result handle\r\n        const newRiskResultHandle = await thisGlucoseCheckContract.getRiskResult(thisEthersSigner.address);\r\n        setRiskResultHandle(newRiskResultHandle);\r\n      } catch (error: any) {\r\n        setMessage(`Check risk failed: ${error.message}`);\r\n      } finally {\r\n        isCheckingRef.current = false;\r\n        setIsChecking(false);\r\n      }\r\n    };\r\n\r\n    run();\r\n  }, [\r\n    ethersSigner,\r\n    glucoseCheck.address,\r\n    glucoseCheck.abi,\r\n    chainId,\r\n    sameChain,\r\n    sameSigner,\r\n  ]);\r\n\r\n  const decryptRiskResult = useCallback(() => {\r\n    if (isDecryptingRef.current) {\r\n      return;\r\n    }\r\n\r\n    if (!glucoseCheck.address || !instance || !ethersSigner) {\r\n      return;\r\n    }\r\n\r\n    if (riskResultHandle === clearRiskResultRef.current?.handle) {\r\n      return;\r\n    }\r\n\r\n    if (!riskResultHandle) {\r\n      setClearRiskResult(undefined);\r\n      clearRiskResultRef.current = undefined;\r\n      return;\r\n    }\r\n\r\n    if (riskResultHandle === ethers.ZeroHash) {\r\n      setClearRiskResult({ handle: riskResultHandle, clear: false });\r\n      clearRiskResultRef.current = { handle: riskResultHandle, clear: false };\r\n      return;\r\n    }\r\n\r\n    const thisChainId = chainId;\r\n    const thisGlucoseCheckAddress = glucoseCheck.address;\r\n    const thisRiskResultHandle = riskResultHandle;\r\n    const thisEthersSigner = ethersSigner;\r\n\r\n    isDecryptingRef.current = true;\r\n    setIsDecrypting(true);\r\n    setMessage(\"Start decrypting risk result...\");\r\n\r\n    const run = async () => {\r\n      const isStale = () =>\r\n        thisGlucoseCheckAddress !== glucoseCheckRef.current?.address ||\r\n        !sameChain.current(thisChainId) ||\r\n        !sameSigner.current(thisEthersSigner);\r\n\r\n      try {// Change #29 - 174454\n        // Enhanced error handling// Change #28 - 174454\n        // Enhanced error handling// Change #20 - 174452\n        // Enhanced error handling// Change #19 - 174452\n        // Enhanced error handling// Change #16 - 174451\n        // Enhanced error handling// Change #14 - 174451\n        // Enhanced error handling// Change #13 - 174451\n        // Enhanced error handling// Change #11 - 174450\n        // Enhanced error handling// Change #4 - 174448\n        // Enhanced error handling// Change #3 - 174448\n        // Enhanced error handling// Change #2 - 174448\n        // Enhanced error handling// Change #1 - 174447\n        // Enhanced error handling// Change #1 - 174351\r\n        // Enhanced error handling// Change #3 - 174327\r\n        // Enhanced error handling\r\n        // Enhanced error handling\r\n        // Enhanced error handling\r\n        const sig: FhevmDecryptionSignature | null =\r\n          await FhevmDecryptionSignature.loadOrSign(\r\n            instance,\r\n            [glucoseCheck.address as `0x${string}`],\r\n            ethersSigner,\r\n            fhevmDecryptionSignatureStorage\r\n          );\r\n\r\n        if (!sig) {\r\n          setMessage(\"Unable to build FHEVM decryption signature\");\r\n          return;\r\n        }\r\n\r\n        if (isStale()) {\r\n          setMessage(\"Ignore FHEVM decryption\");\r\n          return;\r\n        }\r\n\r\n        setMessage(\"Call FHEVM userDecrypt...\");\r\n\r\n        const res = await instance.userDecrypt(\r\n          [{ handle: thisRiskResultHandle, contractAddress: thisGlucoseCheckAddress }],\r\n          sig.privateKey,\r\n          sig.publicKey,\r\n          sig.signature.replace(\"0x\", \"\"),\r\n          sig.contractAddresses,\r\n          sig.userAddress,\r\n          sig.startTimestamp.toString(),\r\n          sig.durationDays.toString()\r\n        );\r\n\r\n        setMessage(\"FHEVM userDecrypt completed!\");\r\n\r\n        if (isStale()) {\r\n          setMessage(\"Ignore FHEVM decryption\");\r\n          return;\r\n        }\r\n\r\n        const decryptedValue = res[thisRiskResultHandle] as boolean;\r\n        setClearRiskResult({ handle: thisRiskResultHandle, clear: decryptedValue });\r\n        clearRiskResultRef.current = {\r\n          handle: thisRiskResultHandle,\r\n          clear: decryptedValue,\r\n        };\r\n\r\n        setMessage(\r\n          `Risk result: ${decryptedValue ? \"High glucose (>140)\" : \"Normal glucose (?40)\"}`\r\n        );\r\n      } catch (error: any) {\r\n        setMessage(`Decryption failed: ${error.message}`);\r\n      } finally {\r\n        isDecryptingRef.current = false;\r\n        setIsDecrypting(false);\r\n      }\r\n    };\r\n\r\n    run();\r\n  }, [\r\n    fhevmDecryptionSignatureStorage,\r\n    ethersSigner,\r\n    glucoseCheck.address,\r\n    instance,\r\n    riskResultHandle,\r\n    chainId,\r\n    sameChain,\r\n    sameSigner,\r\n  ]);\r\n\r\n  // Auto refresh handles\r\n  useEffect(() => {\r\n    if (!glucoseCheck.address || !ethersReadonlyProvider || !ethersSigner || !ethersSigner.address) {\r\n      setGlucoseHandle(undefined);\r\n      setRiskResultHandle(undefined);\r\n      return;\r\n    }\r\n\r\n    const glucoseCheckContract = new ethers.Contract(\r\n      glucoseCheck.address,\r\n      glucoseCheck.abi,\r\n      ethersReadonlyProvider\r\n    );\r\n\r\n    const refresh = async () => {\r\n      try {// Change #29 - 174454\n        // Enhanced error handling// Change #28 - 174454\n        // Enhanced error handling// Change #20 - 174452\n        // Enhanced error handling// Change #19 - 174452\n        // Enhanced error handling// Change #16 - 174451\n        // Enhanced error handling// Change #14 - 174451\n        // Enhanced error handling// Change #13 - 174451\n        // Enhanced error handling// Change #11 - 174450\n        // Enhanced error handling// Change #4 - 174448\n        // Enhanced error handling// Change #3 - 174448\n        // Enhanced error handling// Change #2 - 174448\n        // Enhanced error handling// Change #1 - 174447\n        // Enhanced error handling// Change #1 - 174351\r\n        // Enhanced error handling// Change #3 - 174327\r\n        // Enhanced error handling\r\n        // Enhanced error handling\r\n        // Enhanced error handling\r\n        if (!ethersSigner.address) {\r\n          return;\r\n        }\r\n        const glucose = await glucoseCheckContract.getGlucose(ethersSigner.address);\r\n        setGlucoseHandle(glucose);\r\n\r\n        const riskResult = await glucoseCheckContract.getRiskResult(ethersSigner.address);\r\n        setRiskResultHandle(riskResult);\r\n      } catch (error) {\r\n        console.error(\"Error refreshing handles:\", error);\r\n      }\r\n    };\r\n\r\n    refresh();\r\n    const interval = setInterval(refresh, 5000);\r\n    return () => clearInterval(interval);\r\n  }, [glucoseCheck.address, ethersReadonlyProvider, ethersSigner, glucoseCheck.abi]);\r\n\r\n  return {\r\n    contractAddress: glucoseCheck.address,\r\n    canSubmit,\r\n    canCheckRisk,\r\n    canDecrypt,\r\n    submitGlucose,\r\n    checkRisk,\r\n    decryptRiskResult,\r\n    isDecrypted,\r\n    message,\r\n    clearRiskResult: clearRiskResult?.clear,\r\n    glucoseHandle,\r\n    riskResultHandle,\r\n    isSubmitting,\r\n    isChecking,\r\n    isDecrypting,\r\n    isDeployed,\r\n  };\r\n};\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1718, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo12/pro12/frontend/components/ErrorNotDeployed.tsx"],"sourcesContent":["\"use client\";\r\n\r\nexport function errorNotDeployed(chainId: number | undefined) {\r\n  const chainName = chainId === 11155111 ? \"Sepolia\" : chainId === 31337 ? \"Hardhat\" : `Chain ${chainId}`;\r\n  const networkName = chainId === 11155111 ? \"sepolia\" : \"your-network-name\";\r\n  \r\n  return (\r\n    <div className=\"mx-auto w-full max-w-2xl\">\r\n      <div className=\"bg-white/10 backdrop-blur-lg rounded-2xl p-8 border border-white/20\">\r\n        <h2 className=\"text-3xl font-bold text-white mb-4 text-center\">\r\n          Contract Not Deployed\r\n        </h2>\r\n        <p className=\"text-white/80 mb-4 text-center\">\r\n          <span className=\"font-mono\">GlucoseCheck.sol</span> contract is not deployed on{\" \"}\r\n          <span className=\"font-mono\">{chainName}</span> (chainId: {chainId})\r\n        </p>\r\n        <div className=\"bg-black/50 rounded-lg p-4 mt-6 mb-6\">\r\n          <p className=\"text-white/60 text-sm mb-2\">To deploy on {chainName}, run:</p>\r\n          <code className=\"text-green-400 text-sm block\">\r\n            # from pro12 directory<br />\r\n            npx hardhat deploy --network {networkName}\r\n          </code>\r\n        </div>\r\n        <p className=\"text-white/80 text-center\">\r\n          Or switch to the local <span className=\"font-mono\">Hardhat Node</span> (chainId: 31337) using your Rainbow wallet.\r\n        </p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;AAAA;;AAEO,SAAS,iBAAiB,OAA2B;IAC1D,MAAM,YAAY,YAAY,WAAW,YAAY,YAAY,QAAQ,YAAY,AAAC,SAAgB,OAAR;IAC9F,MAAM,cAAc,YAAY,WAAW,YAAY;IAEvD,qBACE,yMAAC;QAAI,WAAU;kBACb,cAAA,yMAAC;YAAI,WAAU;;8BACb,yMAAC;oBAAG,WAAU;8BAAiD;;;;;;8BAG/D,yMAAC;oBAAE,WAAU;;sCACX,yMAAC;4BAAK,WAAU;sCAAY;;;;;;wBAAuB;wBAA6B;sCAChF,yMAAC;4BAAK,WAAU;sCAAa;;;;;;wBAAiB;wBAAY;wBAAQ;;;;;;;8BAEpE,yMAAC;oBAAI,WAAU;;sCACb,yMAAC;4BAAE,WAAU;;gCAA6B;gCAAc;gCAAU;;;;;;;sCAClE,yMAAC;4BAAK,WAAU;;gCAA+B;8CACvB,yMAAC;;;;;gCAAK;gCACE;;;;;;;;;;;;;8BAGlC,yMAAC;oBAAE,WAAU;;wBAA4B;sCAChB,yMAAC;4BAAK,WAAU;sCAAY;;;;;;wBAAmB;;;;;;;;;;;;;;;;;;AAKhF","debugId":null}},
    {"offset": {"line": 1847, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo12/pro12/frontend/components/GlucoseCheckDemo.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useRef, useEffect } from \"react\";\r\nimport { useAccount, useChainId, usePublicClient } from \"wagmi\";\r\nimport { ConnectButton } from \"@rainbow-me/rainbowkit\";\r\nimport { useFhevm } from \"@/fhevm/useFhevm\";\r\nimport { useInMemoryStorage } from \"@/hooks/useInMemoryStorage\";\r\nimport { useEthersSigner } from \"@/hooks/useEthersSigner\";\r\nimport { useGlucoseCheck } from \"@/hooks/useGlucoseCheck\";\r\nimport { errorNotDeployed } from \"./ErrorNotDeployed\";\r\nimport { ethers } from \"ethers\";\r\n\r\n/*\r\n * Main GlucoseCheck React component\r\n * - Submit encrypted glucose value\r\n * - Check risk assessment (glucose > 140)\r\n * - View and decrypt risk result\r\n */\r\nexport const GlucoseCheckDemo = () => {\r\n  const [mounted, setMounted] = useState(false);\r\n  const { address, isConnected } = useAccount();\r\n  const chainId = useChainId();\r\n  const publicClient = usePublicClient();\r\n  const [glucoseValue, setGlucoseValue] = useState<string>(\"\");\r\n\r\n  useEffect(() => {\r\n    setMounted(true);\r\n  }, []);\r\n\r\n  const { storage: fhevmDecryptionSignatureStorage } = useInMemoryStorage();\r\n  const ethersSigner = useEthersSigner({ chainId });\r\n  const ethersReadonlyProvider = publicClient ? new ethers.BrowserProvider(publicClient.transport as any) : undefined;\r\n\r\n  const sameChainRef = useRef((currentChainId: number | undefined) => currentChainId === chainId);\r\n  const sameSignerRef = useRef((currentSigner: ethers.JsonRpcSigner | undefined) => {\r\n    if (!currentSigner || !ethersSigner) return false;\r\n    // Compare addresses, not object references\r\n    const currentAddress = currentSigner.address;\r\n    const ethersSignerAddress = ethersSigner.address;\r\n    if (!currentAddress || !ethersSignerAddress) return false;\r\n    return currentAddress.toLowerCase() === ethersSignerAddress.toLowerCase();\r\n  });\r\n\r\n  // Update refs when chainId or ethersSigner changes\r\n  useEffect(() => {\r\n    sameChainRef.current = (currentChainId: number | undefined) => currentChainId === chainId;\r\n  }, [chainId]);\r\n\r\n  useEffect(() => {\r\n    sameSignerRef.current = (currentSigner: ethers.JsonRpcSigner | undefined) => {\r\n      if (!currentSigner || !ethersSigner) return false;\r\n      const currentAddress = currentSigner.address;\r\n      const ethersSignerAddress = ethersSigner.address;\r\n      if (!currentAddress || !ethersSignerAddress) return false;\r\n      return currentAddress.toLowerCase() === ethersSignerAddress.toLowerCase();\r\n    };\r\n  }, [ethersSigner]);\r\n\r\n  const provider = publicClient?.transport as ethers.Eip1193Provider | undefined;\r\n\r\n  // Only use mock chains for local development (chainId 31337)\r\n  const initialMockChains = chainId === 31337 \r\n    ? { 31337: \"http://localhost:8545\" } \r\n    : undefined;\r\n\r\n  const {\r\n    instance: fhevmInstance,\r\n    status: fhevmStatus,\r\n    error: fhevmError,\r\n  } = useFhevm({\r\n    provider,\r\n    chainId,\r\n    initialMockChains,\r\n    enabled: true,\r\n  });\r\n\r\n  const glucoseCheck = useGlucoseCheck({\r\n    instance: fhevmInstance,\r\n    fhevmDecryptionSignatureStorage,\r\n    eip1193Provider: provider,\r\n    chainId,\r\n    ethersSigner,\r\n    ethersReadonlyProvider,\r\n    sameChain: sameChainRef,\r\n    sameSigner: sameSignerRef,\r\n  });\r\n\r\n  const handleSubmitGlucose = async () => {\r\n    if (!glucoseValue) return;\r\n\r\n    const value = parseInt(glucoseValue);\r\n    if (isNaN(value) || value < 0) {\r\n      return;\r\n    }\r\n\r\n    await glucoseCheck.submitGlucose(value);\r\n  };\r\n\r\n  const handleCheckRisk = async () => {\r\n    await glucoseCheck.checkRisk();\r\n  };\r\n\r\n  const handleDecryptResult = async () => {\r\n    glucoseCheck.decryptRiskResult();\r\n  };\r\n\r\n  const buttonClass =\r\n    \"inline-flex items-center justify-center rounded-xl bg-purple-600 px-6 py-3 font-semibold text-white shadow-sm \" +\r\n    \"transition-colors duration-200 hover:bg-purple-700 active:bg-purple-800 \" +\r\n    \"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-purple-500 focus-visible:ring-offset-2 \" +\r\n    \"disabled:opacity-50 disabled:pointer-events-none\";\r\n\r\n  const titleClass = \"font-semibold text-white text-lg mt-4 mb-2\";\r\n\r\n  if (!mounted) {\r\n    return (\r\n      <div className=\"mx-auto w-full max-w-2xl\">\r\n        <div className=\"bg-white/10 backdrop-blur-lg rounded-2xl p-8 border border-white/20\">\r\n          <div className=\"text-center\">\r\n            <div className=\"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-white\"></div>\r\n            <p className=\"text-white/80 mt-4\">Loading...</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!isConnected) {\r\n    return (\r\n      <div className=\"mx-auto w-full max-w-2xl\">\r\n        <div className=\"bg-white/10 backdrop-blur-lg rounded-2xl p-8 border border-white/20\">\r\n          <h2 className=\"text-3xl font-bold text-white mb-4 text-center\">\r\n            Connect Your Wallet\r\n          </h2>\r\n          <p className=\"text-white/80 text-center mb-6\">\r\n            Please connect your Rainbow wallet to use the Encrypted Glucose Check system\r\n          </p>\r\n          <div className=\"flex justify-center\">\r\n            <ConnectButton />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (glucoseCheck.isDeployed === false) {\r\n    return errorNotDeployed(chainId);\r\n  }\r\n\r\n  const hasGlucose = glucoseCheck.glucoseHandle && glucoseCheck.glucoseHandle !== ethers.ZeroHash;\r\n  const hasRiskResult = glucoseCheck.riskResultHandle && glucoseCheck.riskResultHandle !== ethers.ZeroHash;\r\n\r\n  return (\r\n    <div className=\"grid w-full gap-6 max-w-4xl mx-auto\">\r\n      <div className=\"col-span-full flex justify-end\">\r\n        <ConnectButton />\r\n      </div>\r\n\r\n      <div className=\"col-span-full bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20\">\r\n        <h2 className=\"text-2xl font-bold text-white mb-4\">Submit Glucose Value</h2>\r\n        <div className=\"flex gap-4\">\r\n          <input\r\n            type=\"number\"\r\n            value={glucoseValue}\r\n            onChange={(e) => setGlucoseValue(e.target.value)}\r\n            placeholder=\"Enter glucose value (mg/dL)\"\r\n            className=\"flex-1 px-4 py-2 rounded-lg bg-white/20 border border-white/30 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-purple-500\"\r\n            min=\"0\"\r\n          />\r\n          <button\r\n            className={buttonClass}\r\n            onClick={handleSubmitGlucose}\r\n            disabled={!glucoseCheck.canSubmit || !glucoseValue || isNaN(parseInt(glucoseValue)) || parseInt(glucoseValue) <= 0}\r\n          >\r\n            {glucoseCheck.isSubmitting ? \"Submitting...\" : \"Submit\"}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"col-span-full bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20\">\r\n        <h2 className=\"text-2xl font-bold text-white mb-4\">Risk Assessment</h2>\r\n        <p className=\"text-white/80 mb-4\">\r\n          Check if your glucose level is high (glucose {'>'} 140 mg/dL)\r\n        </p>\r\n        <button\r\n          className={buttonClass}\r\n          onClick={handleCheckRisk}\r\n          disabled={!glucoseCheck.canCheckRisk}\r\n        >\r\n          {glucoseCheck.isChecking ? \"Checking...\" : \"Check Risk\"}\r\n        </button>\r\n      </div>\r\n\r\n      {hasRiskResult && (\r\n        <div className=\"col-span-full bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20\">\r\n          <h2 className=\"text-2xl font-bold text-white mb-4\">Risk Result</h2>\r\n          <p className=\"text-white/80 mb-4\">\r\n            Your encrypted risk assessment result is available. Decrypt to view the result.\r\n          </p>\r\n          <button\r\n            className={buttonClass}\r\n            onClick={handleDecryptResult}\r\n            disabled={!glucoseCheck.canDecrypt}\r\n          >\r\n            {glucoseCheck.isDecrypting\r\n              ? \"Decrypting...\"\r\n              : glucoseCheck.isDecrypted\r\n                ? `Decrypted: ${glucoseCheck.clearRiskResult ? \"High\" : \"Normal\"}`\r\n                : \"Decrypt Result\"}\r\n          </button>\r\n          {glucoseCheck.isDecrypted && glucoseCheck.clearRiskResult !== undefined && (\r\n            <div className=\"mt-4 p-4 bg-white/20 rounded-lg\">\r\n              <p className=\"text-white font-semibold\">\r\n                Result: {glucoseCheck.clearRiskResult ? \" High glucose (>140 mg/dL)\" : \" Normal glucose (140 mg/dL)\"}\r\n              </p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/*  */}\r\n    </div>\r\n  );\r\n};\r\n\r\n"],"names":[],"mappings":"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","debugId":null}}]
}